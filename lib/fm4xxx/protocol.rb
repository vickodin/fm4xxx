# http://www.iptech.com.ua/downloads/gsmmodem/teltonika/fm4100/FM4XXX%20DATA%20protocol%20preliminar%20description%20v1.0.pdf
module FM4XXX
  class Protocol
    # Avl data array
    # ┌────────┬──────────────┬──────┬───────────────┐
    # │Codec ID│Number of Data│ Data │Number of Data │
    # ├────────┼──────────────┼──────┼───────────────┤
    # │ 1 Byte │   1 Byte     │  …   │    1 Byte     │
    # └────────┴──────────────┴──────┴───────────────┘

    
    # Data
    # ┌────────┬───┬──────────┐
    # │AVL Data│ … │ AVL Data │
    # └────────┴───┴──────────┘

    # Avl data
    # ┌─────────┬────────┬────────────┬──────────┐
    # │Timestamp│Priority│ GPS Element│IO Element│
    # ├─────────┼────────┼────────────┼──────────┤
    # │ 8 Bytes │ 1 Byte │  15 Bytes  │    …     │
    # └─────────┴────────┴────────────┴──────────┘
    
    # Gps Element 
    # ┌───────────┬──────────┬──────────┬───────┬────────────┬───────┐
    # │ Longitude │ Latitude │ Altitude │ Angle │ Satellites │ Speed │
    # ├───────────┼──────────┼──────────┼───────┼────────────┼───────┤
    # │  4 Bytes  │  4 Bytes │  2 Bytes │2 Bytes│   1 Byte   │2 Bytes│
    # └───────────┴──────────┴──────────┴───────┴────────────┴───────┘

    # IO element 
    # ┌───────────────────┬────────┐
    # │Event IO ID        │1 Byte  │
    # │N of Total IO      │1 Byte  │
    # │N1 of One Byte IO  │1 Byte  │
    # │1’st IO ID         │1 Byte  │
    # │1’st IO Value      │1 Byte  │
    # │…                  │        │
    # │N1’th IO ID        │1 Byte  │
    # │N1’th IO Value     │1 Byte  │
    # │N2 of Two Bytes    │1 Byte  │
    # │1’st IO ID         │1 Byte  │
    # │1’st IO Value      │2 Bytes │
    # │…                  │        │
    # │N2’th IO ID        │1 Byte  │
    # │N2’th IO Value     │2 Bytes │
    # │N4 of Four Bytes   │1 Byte  │
    # │1’st IO ID         │1 Byte  │
    # │1’st IO Value      │4 Bytes │
    # │…                  │        │
    # │N4’th IO ID        │1 Byte  │
    # │N4’th IO Value     │4 Bytes │
    # │N8 of Eight Bytes  │1 Byte  │
    # │1’st IO ID         │1 Byte  │
    # │1’st IO Value      │8 Bytes │
    # │…                  │        │
    # │N8’th IO ID        │1 Bytes │
    # │N8’th IO Value     │8 Bytes │
    # └───────────────────┴────────┘

    # Example
    # 080400000113fc208dff000f14f650209cca80006f00d604000404030101150316030001460000015d0000000113fc17610b000f14ffe0209cc580006e00c705000104030101150316010001460000015e0000000113fc284945000f150f00209cd2000095010804000004030101150016030001460000015d0000000113fc267c5b000f150a50209cccc00093006804000004030101150016030001460000015b0004
    #
    # Avl data array
    # ┌────────┬──────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬───────────────┐
    # │Codec ID│Number of Data│ Data                                                                                                                                                                                                                                                                                                                           │Number of Data │
    # ├────────┼──────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼───────────────┤
    # │   08   │     04       │00000113fc208dff000f14f650209cca80006f00d604000404030101150316030001460000015d0000000113fc17610b000f14ffe0209cc580006e00c705000104030101150316010001460000015e0000000113fc284945000f150f00209cd2000095010804000004030101150016030001460000015d0000000113fc267c5b000f150a50209cccc00093006804000004030101150016030001460000015b00│04             │
    # └────────┴──────────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴───────────────┘
    #
    # First Avl data
    # 00000113fc208dff000f14f650209cca80006f00d604000404030101150316030001460000015d00
    # ┌──────────────────┬──────────┬─────────────────────┬────────────────────────────────────────────────────────┐
    # │ Timestamp        │ Priority │ GPS Element         │ IO Element                                             │
    # ├──────────────────┼──────────┼─────────────────────┼────────────────────────────────────────────────────────┤
    # │ 00000113fc208dff │ 00       │  0f14f650 Longitude │ 04        4 IO elements in record                      │
    # │                  │          │  209cca80 Latitude  │ 03        3 IO elements, which length is 1 Byte        │    │
    # │                  │          │  006f     Altitude  │ 01        IO element ID = 01                           │
    # │                  │          │  00d6     Angle     │ 01        1’st IO element’s value = 1                  │
    # │                  │          │  04       Satelites │ 15        IO element ID = 21                           │
    # │                  │          │  0004     Speed     │ 03        21’st IO element’s value = 3                 │
    # │                  │          │                     │ 16        IO element ID = 22                           │
    # │                  │          │                     │ 03        22’nd IO element’s value = 3                 │
    # │                  │          │                     │ 00        0 IO elements, which value length is 2 Bytes │
    # │                  │          │                     │ 01        1 IO element, which value length is 4 Bytes  │
    # │                  │          │                     │ 46        IO element ID = 70                           │
    # │                  │          │                     │ 0000015d  70’th IO element’s value = 349               │
    # │                  │          │                     │ 00        0 IO elements, which value length is 8 Bytes │
    # └──────────────────┴──────────┴─────────────────────┴────────────────────────────────────────────────────────┘

    # Second record data
    # Timestamp        Priority GPS Element                    IO Element
    # 00000113fc17610b 00       0f14ffe0209cc580006e00c7050001 04030101150316010001460000015e00
    # 00000113fc17610b 00       0f14ffe0209cc580006e00c7050001 04030101150316010001460000015e00

    # Third record data
    # 00000113fc284945 00 0f150f00209cd20000950108040000 04030101150016030001460000015d00
    # 00000113fc284945 00 0f150f00209cd20000950108040000 04030101150016030001460000015d00

    # Fourth record data
    # 00000113fc267c5b 00 0f150a50209cccc000930068040000 04030101150016030001460000015b00
    # 00000113fc267c5b 00 0f150a50209cccc000930068040000 04030101150016030001460000015b00

    # 04 = Number of data
  end
end